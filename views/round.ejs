<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="../scripts/break-a-thon.js" defer></script>
    <title>Break-a-thon | Round <!-- roundNumber --> </title>

    <script>
        const FirstName = "<%= encryptedData[0] %>"
        const LastName = "<%= encryptedData[1] %>"
        const FavoriteColor = "<%= encryptedData[2] %>"
        const PetsName = "<%= encryptedData[3] %>"


        const PASSWORD = "<%= password %>"
        var aspects = '<%= aspects %>'
        const ASPECTS = aspects.split(",")

        console.log(PASSWORD, ASPECTS, FirstName, LastName, FavoriteColor, PetsName)
    </script>
</head>
<body>
    <header>
        <nav style="padding: 20px" class="navbar navbar-light bg-light">
            <a style="font-size: 1.6rem;" class="navbar-brand mx-auto" href="#">
              Break-a-Thon
            </a>
          </nav>
    </header>
    <p id="countdown"></p>
    <p>Name: <%= encryptedData[0] %></p>
    <p>Birthday: <%= person['person']['birthday'][1]['day'][1] %> <%= person['person']['birthday'][1]['month'] %> <%= person['person']['birthday'][1]['year'] %></p>
    <p>Favorite Color: <%= encryptedData[1] %></p>
    <p>Pet's Name: <%= encryptedData[2] %> (<%= person['pet']['species'] %>)</p>
    <h1>Aspects: </h1>
    <div id="aspect-container">
    </div>

    <form id="guess-pass-form">
        <input type="text" id=passwordguess placeholder="Your guess!" required>
        <input type="submit">
    </form>

    <script>
        if (!JSON.parse(localStorage.getItem("teams"))) window.location.replace('/')
        // if (JSON.parse(localStorage.getItem("round"))) window.location.replace('/')
        localStorage.setItem("state", JSON.stringify({ round: 1, stage: 1 }))

        window.onload = async () => {
            await fetch('/round', {
                method: "POST",
                headers: {'Content-Type': "application/json"},
                body: JSON.stringify({ teams: JSON.parse(localStorage.getItem("teams")), state: JSON.parse(localStorage.getItem("state")) })
            })
        
        const form = document.getElementById('guess-pass-form')

        form.addEventListener('submit', async (e) => {
            e.preventDefault()

            const guessedPass = document.getElementById("passwordguess")

            if (guessedPass != PASSWORD)

            localStorage.setItem("teams", JSON.stringify({team1: {name: team1, score: 0}, team2: {name: team2, score: 0}, team3: {name: team3, score: 0}, team4: {name: team4, score: 0}}))
            console.log(JSON.parse(localStorage.getItem("teams")))
            window.location.replace('/round')
        })
        }

        
        const aspectContainer = document.getElementById("aspect-container")
        for (let i = 0; i < ASPECTS.length; i++) {
            console.log(ASPECTS[i])
            const p = document.createElement("p")
            p.appendChild(document.createTextNode(ASPECTS[i]))
            aspectContainer.appendChild(p)
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
</body>
</html>